<!DOCTYPE HTML>
<html lang="vi" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Option, Result - Rust Tiếng Việt</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Cơ bản</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Variables</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Cargo</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.1.</strong> cargo r</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.2.</strong> cargo t</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.</strong> cargo d</div></li></ol></li><li class="chapter-item expanded "><a href="../basic/ownership.html"><strong aria-hidden="true">3.</strong> Ownership</a></li><li class="chapter-item expanded "><a href="../basic/variables.html"><strong aria-hidden="true">4.</strong> Variables</a></li><li class="chapter-item expanded "><a href="../basic/box.html"><strong aria-hidden="true">5.</strong> Box</a></li><li class="chapter-item expanded "><a href="../basic/option-result.html" class="active"><strong aria-hidden="true">6.</strong> Option, Result</a></li><li class="chapter-item expanded "><a href="../basic/code-comment.html"><strong aria-hidden="true">7.</strong> /// code comment</a></li><li class="chapter-item expanded "><a href="../basic/struct.html"><strong aria-hidden="true">8.</strong> Struct</a></li><li class="chapter-item expanded "><a href="../basic/trait.html"><strong aria-hidden="true">9.</strong> Trait</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../basic/copy-clone.html"><strong aria-hidden="true">9.1.</strong> Copy, Clone</a></li><li class="chapter-item expanded "><a href="../basic/fromstr.html"><strong aria-hidden="true">9.2.</strong> FromStr</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.3.</strong> Display</div></li></ol></li><li class="chapter-item expanded "><a href="../basic/turbofish.html"><strong aria-hidden="true">10.</strong> Turbofish ::&lt;&gt;</a></li><li class="chapter-item expanded "><a href="../basic/macro/index.html"><strong aria-hidden="true">11.</strong> macros!</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../basic/macro/println.html"><strong aria-hidden="true">11.1.</strong> println!</a></li><li class="chapter-item expanded "><a href="../basic/macro/format.html"><strong aria-hidden="true">11.2.</strong> format!</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.3.</strong> macro_rules!</div></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Crates hay dùng</li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> tokio.rs</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> actix-web</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> anyhow</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> serde</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> clap</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.</strong> log</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> config</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Design patterns</li><li class="chapter-item expanded "><div><strong aria-hidden="true">19.</strong> Behavioural Patterns</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.</strong> Creational Patterns</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">21.</strong> Structural Patterns</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Rust Idioms</li><li class="chapter-item expanded affix "><div>Concatenating strings with format!</div></li><li class="chapter-item expanded affix "><div>Constructor</div></li><li class="chapter-item expanded affix "><div>The Default Trait</div></li><li class="chapter-item expanded affix "><div>Finalisation in destructors</div></li><li class="chapter-item expanded affix "><div>Temporary mutability</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Tiếng Việt</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="option-result"><a class="header" href="#option-result">Option, Result</a></h1>
<p>Nhiều ngôn ngữ sử dụng kiểu dữ liệu <code>null</code> hoặc <code>nil</code> hoặc <code>undefined</code> để đại diện cho các giá trị rỗng hoặc không tồn tại, và sử dụng <code>Exception</code> để xử lý lỗi. Rust bỏ qua hai khái niệm này, để tránh gặp phải các lỗi phổ biến như <strong>null pointer exceptions,</strong> hay <strong>lộ thông tin nhạy cảm thông qua exceptions,</strong> ... Thay vào đó, Rust giới thiệu hai generic enums <code>Option</code> và <code>Result</code> để giải quyết các vấn đề trên.</p>
<h1 id="1-option"><a class="header" href="#1-option">1. Option</a></h1>
<p>Trong hầu hết các ngôn ngữ họ C (C, C#, Java, ...), để xác định một cái gì đó failed hay không tìm được giá trị thỏa mãn, chúng ta thường trả về một giá trị <em>“đặc biệt”</em> nào đó. Ví dụ <code>indexOf()</code> của Javascript scan một phần tử trong mảng, trả về vị trí của phần tử đó trong mảng. Và trả về <code>-1</code> nếu không tìm thấy. </p>
<p>Dẫn đến, ta sẽ thường thấy một số đoạn code như sau đây:</p>
<pre><code class="language-typescript">let sentence = &quot;The fox jumps over the dog&quot;;
let index = sentence.indexOf(&quot;fox&quot;);

if (index &gt; -1) {
  let result = sentence.substr(index);
  console.log(result);
}
</code></pre>
<p>Như bạn thấy <code>-1</code> là một trường hợp đặc biệt cần xử lý. Có khi nào bạn đã từng mắc lỗi ngớ ngẫn vì tưởng giá trị đặc biệt đó là <code>0</code> chưa?</p>
<pre><code class="language-typescript">if (index &gt; 0) {
  // 3000 days of debugging
}
</code></pre>
<p><code>&quot;&quot;</code> hay <code>null</code> hay <code>None</code> cũng là một trong những trường hợp đặc biệt đó. Bạn đã từng nghe đến <strong><strong><a href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/">Null References: The Billion Dollar Mistake</a></strong></strong>?</p>
<p>Lý do cơ bản là không có gì chắc chắn và có thể ngăn bạn lại việc ... <strong>quên</strong> 
xử lý mọi trường hợp giá trị đặc biệt, hoặc do chương trình trả về các giá trị đặc biệt không như mong đợi.
Có nghĩa là ta có thể <em>vô tình</em> làm crash chương trình với một lỗi nhỏ ở bất kỳ đâu, ở bất kỳ thời điểm nào.</p>
<p>Rust làm điều này tốt hơn, chỉ với <code>Option</code>. </p>
<p>Một giá trị optional có thể mang một giá trị nào đó <strong>Some(something)</strong> hoặc không mang giá trị nào cả (<strong>None</strong>).</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// An output can have either Some value or no value/ None.
enum Option&lt;T&gt; { // T is a generic and it can contain any type of value.
  Some(T),
  None,
}
<span class="boring">}
</span></code></pre></pre>
<p>Theo thiết kế, mặc định bạn sẽ không bao giờ lấy được giá trị bạn cần nếu không xử lý 
các trường hợp có thể xảy ra với <code>Option</code>, là <code>None</code> chẳng hạn. 
Điều này được bắt buộc bởi compiler lúc compile code, có nghĩa là nếu bạn quên check, code sẽ không bao giờ được compile.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let sentence = &quot;The fox jumps over the dog&quot;;
let index = sentence.find(&quot;fox&quot;);

if let Some(fox) = index {
  let words_after_fox = &amp;sentence[fox..];
  println!(&quot;{}&quot;, words_after_fox);
}
<span class="boring">}
</span></code></pre></pre>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=8d3d53cae73b642797337b6e1b01e58b">(Rust Playground)</a></p>
<h2 id="cách-sử-dụng-option"><a class="header" href="#cách-sử-dụng-option"><strong>Cách sử dụng Option</strong></a></h2>
<p>Option là standard library, do đã được <a href="https://learning-rust.github.io/docs/d7.std_primitives_and_preludes.html#Preludes">preludes</a> nên chúng ta không cần khai báo trước khi sử dụng. Ngoài enum <a href="https://doc.rust-lang.org/std/option/enum.Option.html">Option</a> thì các variant của nó cũng đã được preludes sẵn như <a href="https://doc.rust-lang.org/std/option/enum.Option.html#variant.Some">Some</a> và <a href="https://doc.rust-lang.org/std/option/enum.Option.html#variant.None">None</a>.</p>
<p>Ví dụ, ta có một function tính giá trị chia hai số, đôi khi sẽ không tìm ra được kết quả, ta sử dụng Some nhu sau:</p>
<pre><pre class="playground"><code class="language-rust">fn divide(numerator: f64, denominator: f64) -&gt; Option&lt;f64&gt; {
  if denominator == 0.0 {
    None
  } else {
    Some(numerator / denominator)
  }
}

fn main() {
  // The return value of the function is an option
  let result = divide(2.0, 3.0);

  // Pattern match to retrieve the value
  match result {
    // The division was valid
    Some(x) =&gt; println!(&quot;Result: {}&quot;, x),
    // The division was invalid
    None    =&gt; println!(&quot;Cannot divide by 0&quot;),
  }
}
</code></pre></pre>
<p>Ta thường sử dụng <code>match</code> để bắt giá trị trả về (<code>Some</code> hoặc <code>None</code>). </p>
<p>Bạn sẽ bắt gặp rất rất nhiều method khác nhau để xử lý giá trị của <code>Option</code></p>
<p>Option method overview: <a href="https://doc.rust-lang.org/std/option/#method-overview">https://doc.rust-lang.org/std/option/#method-overview</a></p>
<h3 id="unwrap"><a class="header" href="#unwrap"><code>.unwrap()</code></a></h3>
<p>Trả về giá trị nằm trong <code>Some</code>. Nếu giá trị là None có thể dẫn đến panic chương trình. </p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = Some(&quot;air&quot;);
assert_eq!(x.unwrap(), &quot;air&quot;);

let x: Option&lt;&amp;str&gt; = None;
assert_eq!(x.unwrap(), &quot;air&quot;); // panic!
<span class="boring">}
</span></code></pre></pre>
<h3 id="expect"><a class="header" href="#expect"><code>.expect()</code></a></h3>
<p>Giống <code>.unwrap()</code>, nhưng nếu panic thì Rust sẽ kèm theo message</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: Option&lt;&amp;str&gt; = None;
x.expect(&quot;fruits are healthy&quot;); // panics: `fruits are healthy`
<span class="boring">}
</span></code></pre></pre>
<h3 id="unwrap_or"><a class="header" href="#unwrap_or"><code>.unwrap_or()</code></a></h3>
<p>Trả về giá trị nằm trong <code>Some</code>, nếu không trả về giá trị nằm trong <code>or</code></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(Some(&quot;car&quot;).unwrap_or(&quot;bike&quot;), &quot;car&quot;);
<span class="boring">}
</span></code></pre></pre>
<h3 id="unwrap_or_default"><a class="header" href="#unwrap_or_default"><code>.unwrap_or_default()</code></a></h3>
<p>Trả về giá trị nằm trong <code>Some</code>, nếu không trả về giá <a href="https://doc.rust-lang.org/std/default/trait.Default.html#tymethod.default">default</a>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let good_year_from_input = &quot;1909&quot;;
let bad_year_from_input = &quot;190blarg&quot;;
let good_year = good_year_from_input.parse().ok().unwrap_or_default();
let bad_year = bad_year_from_input.parse().ok().unwrap_or_default();

assert_eq!(1909, good_year);
assert_eq!(0, bad_year);
<span class="boring">}
</span></code></pre></pre>
<h3 id="ok_or"><a class="header" href="#ok_or"><code>.ok_or()</code></a></h3>
<p>Convert <code>Option&lt;T&gt;</code> sang <a href="https://doc.rust-lang.org/std/result/enum.Result.html"><code>Result&lt;T, E&gt;</code></a>, 
mapping <a href="https://doc.rust-lang.org/std/option/enum.Option.html#variant.Some"><code>Some(v)</code></a> 
thành <a href="https://doc.rust-lang.org/std/result/enum.Result.html#variant.Ok"><code>Ok(v)</code></a> 
và <a href="https://doc.rust-lang.org/std/option/enum.Option.html#variant.None"><code>None</code></a> 
sang <a href="https://doc.rust-lang.org/std/result/enum.Result.html#variant.Err"><code>Err(err)</code></a>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = Some(&quot;foo&quot;);
assert_eq!(x.ok_or(0), Ok(&quot;foo&quot;));
<span class="boring">}
</span></code></pre></pre>
<h3 id="match"><a class="header" href="#match"><code>match</code></a></h3>
<p>Chúng ta có thể sử dụng pattern matching để code dễ đọc hơn</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn get_name(who: Option&lt;String&gt;) -&gt; String {
  match who {
    Some(name) =&gt; format!(&quot;Hello {}&quot;, name),
    None       =&gt; &quot;Who are you?&quot;.to_string(), 
  }
}

get_name(Some(&quot;duyet&quot;));
<span class="boring">}
</span></code></pre></pre>
<h1 id="2-result"><a class="header" href="#2-result">2. Result</a></h1>
<p>Tương tự như <code>Option</code>. Một kết quả trả về (<strong><code>Result</code></strong>) của một function thường sẽ có hai trường hợp:</p>
<ul>
<li>thành công (<strong><code>Ok</code></strong>) và trả về kết quả</li>
<li>hoặc lỗi (<strong><code>Err</code></strong>) và trả về thông tin lỗi.</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Result&lt;T, E&gt; {
  Ok(T),
  Err(E),
}
<span class="boring">}
</span></code></pre></pre>
<p>Ví dụ</p>
<pre><pre class="playground"><code class="language-rust">fn get_age(who: &amp;str) -&gt; Result&lt;i8, &amp;str&gt; {
  if who == &quot;duyet&quot; {
    Ok(18)
  } else {
    Err(&quot;unknown&quot;)
  }
}

fn main() -&gt; Result&lt;(), &amp;'static str&gt; {
  let who = &quot;duyet&quot;;

  match get_age(who) {
    Ok(age)  =&gt; println!(&quot;{} is {}&quot;, who, age),
    Err(err) =&gt; println!(&quot;Err: {}&quot;, err),
  }

  Ok(())
}
</code></pre></pre>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=3628b261807f0c18481f516f82e8694e">(Rust Playground)</a></p>
<p>Như bạn thấy thì <code>main()</code> cũng có thể return về <code>Result&lt;(), &amp;'static str&gt;</code></p>
<h3 id="unwrap-1"><a class="header" href="#unwrap-1"><code>.unwrap()</code></a></h3>
<p>Ví dụ trên nhưng sử dụng <code>.unwrap()</code> , chủ động panic (crash) dừng chương trình nếu gặp lỗi.</p>
<pre><pre class="playground"><code class="language-rust">fn main() -&gt; Result&lt;(), &amp;'static str&gt; {
  let who = &quot;duyet&quot;;
  let age = get_age(who).unwrap();
  println!(&quot;{} is {}&quot;, who, age);

  Ok(())
}
</code></pre></pre>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=c93551e94e040369d5874672495e3fc9">(Rust Playground)</a></p>
<h3 id="expect-1"><a class="header" href="#expect-1"><code>.expect()</code></a></h3>
<p>Giống như <code>unwrap()</code>: chủ động panic (crash) dừng chương trình nếu gặp lỗi và kèm theo message. Sẽ rất có ích, nhất là khi có quá nhiều unwrap, bạn sẽ không biết nó panic ở đâu.</p>
<pre><pre class="playground"><code class="language-rust">fn main() -&gt; Result&lt;(), &amp;'static str&gt; {
  let who = &quot;ngan&quot;;
  let age = get_age(who).expect(&quot;could not get age&quot;);
  println!(&quot;{} is {}&quot;, who, age);

  Ok(())
}
</code></pre></pre>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=1be3f135f1abeb6bc29d2bba5a99ccda">(Rust Playground)</a></p>
<p>Xem thêm mọi method khác của Result <a href="https://doc.rust-lang.org/std/result/enum.Result.html">tại đây</a>.</p>
<h1 id="3-convert-result-sang-option"><a class="header" href="#3-convert-result-sang-option">3. Convert <code>Result</code> sang <code>Option</code></a></h1>
<p>Đôi khi bạn sẽ cần convert từ <code>Ok(v)</code> sang <code>Some(v)</code> hoặc <code>Err(e)</code> sang <code>Some(e)</code></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// .ok(v) = Some(v)
let x: Result&lt;u32, &amp;str&gt; = Ok(2);
assert_eq!(x.ok(), Some(2));

let x: Result&lt;u32, &amp;str&gt; = Err(&quot;Nothing here&quot;);
assert_eq!(x.ok(), None);

// .err()
let x: Result&lt;u32, &amp;str&gt; = Ok(2);
assert_eq!(x.err(), None);

let x: Result&lt;u32, &amp;str&gt; = Err(&quot;Nothing here&quot;);
assert_eq!(x.err(), Some(&quot;Nothing here&quot;));
<span class="boring">}
</span></code></pre></pre>
<h1 id="4-toán-tử-"><a class="header" href="#4-toán-tử-">4. Toán tử <code>?</code></a></h1>
<p>Khi viết code mà có quá nhiều functions trả về <a href="https://doc.rust-lang.org/std/result/enum.Result.html">Result</a>, việc handle Err sẽ khá nhàm chán. Toán tử chấm hỏi <a href="https://doc.rust-lang.org/std/ops/trait.Try.html">?</a> cho phép dừng function tại vị trí đó và return cho function cha nếu <a href="https://doc.rust-lang.org/std/result/enum.Result.html">Result</a> ở vị trí đó là Err.</p>
<p>Nó sẽ thay thế đoạn code sau:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fs::File;
use std::io::prelude::*;
use std::io;

struct Info {
  name: String,
  age: i32,
  rating: i32,
}

fn write_info(info: &amp;Info) -&gt; io::Result&lt;()&gt; {
  // Early return on error
  let mut file = match File::create(&quot;my_best_friends.txt&quot;) {
    Err(e) =&gt; return Err(e),
    Ok(f) =&gt; f,
  };
  if let Err(e) = file.write_all(format!(&quot;name: {}\n&quot;, info.name).as_bytes()) {
    return Err(e)
  }
  if let Err(e) = file.write_all(format!(&quot;age: {}\n&quot;, info.age).as_bytes()) {
    return Err(e)
  }
  if let Err(e) = file.write_all(format!(&quot;rating: {}\n&quot;, info.rating).as_bytes()) {
    return Err(e)
  }
  Ok(())
}
<span class="boring">}
</span></code></pre></pre>
<p>thành</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fs::File;
use std::io::prelude::*;
use std::io;

struct Info {
  name: String,
  age: i32,
  rating: i32,
}

fn write_info(info: &amp;Info) -&gt; io::Result&lt;()&gt; {
  let mut file = File::create(&quot;my_best_friends.txt&quot;)?;
  // Early return on error
  file.write_all(format!(&quot;name: {}\n&quot;, info.name).as_bytes())?;
  file.write_all(format!(&quot;age: {}\n&quot;, info.age).as_bytes())?;
  file.write_all(format!(&quot;rating: {}\n&quot;, info.rating).as_bytes())?;
  Ok(())
}
<span class="boring">}
</span></code></pre></pre>
<p>Gọn đẹp hơn rất nhiều.</p>
<p>Toán tử <code>?</code> sẽ unwrap giá trị <code>Ok</code>, hoặc return giá trị <code>Err</code> ở vị trí gần toán tử đó.</p>
<p><code>?</code> chỉ có thể được dùng trong function có kiểu dữ liệu trả về là <a href="https://doc.rust-lang.org/std/result/enum.Result.html">Result</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../basic/box.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../basic/code-comment.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../basic/box.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../basic/code-comment.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
