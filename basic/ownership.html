<!DOCTYPE HTML>
<html lang="vi" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Ownership - Rust Tiếng Việt</title>


        <!-- Custom HTML head -->
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-88RKF7DLPY"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-88RKF7DLPY');
        </script>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Cơ bản</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Variables</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Cargo</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.1.</strong> cargo r</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.2.</strong> cargo t</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.</strong> cargo d</div></li></ol></li><li class="chapter-item expanded "><a href="../basic/ownership.html" class="active"><strong aria-hidden="true">3.</strong> Ownership</a></li><li class="chapter-item expanded "><a href="../basic/variables.html"><strong aria-hidden="true">4.</strong> Variables</a></li><li class="chapter-item expanded "><a href="../basic/box.html"><strong aria-hidden="true">5.</strong> Box</a></li><li class="chapter-item expanded "><a href="../basic/option-result.html"><strong aria-hidden="true">6.</strong> Option, Result</a></li><li class="chapter-item expanded "><a href="../basic/code-comment.html"><strong aria-hidden="true">7.</strong> /// code comment</a></li><li class="chapter-item expanded "><a href="../basic/struct.html"><strong aria-hidden="true">8.</strong> Struct</a></li><li class="chapter-item expanded "><a href="../basic/trait.html"><strong aria-hidden="true">9.</strong> Trait</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../basic/copy-clone.html"><strong aria-hidden="true">9.1.</strong> Copy, Clone</a></li><li class="chapter-item expanded "><a href="../basic/fromstr.html"><strong aria-hidden="true">9.2.</strong> FromStr</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.3.</strong> Display</div></li></ol></li><li class="chapter-item expanded "><a href="../basic/turbofish.html"><strong aria-hidden="true">10.</strong> Turbofish ::&lt;&gt;</a></li><li class="chapter-item expanded "><a href="../basic/macro/index.html"><strong aria-hidden="true">11.</strong> macros!</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../basic/macro/println.html"><strong aria-hidden="true">11.1.</strong> println!</a></li><li class="chapter-item expanded "><a href="../basic/macro/format.html"><strong aria-hidden="true">11.2.</strong> format!</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.3.</strong> macro_rules!</div></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Crates hay dùng</li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> tokio.rs</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> actix-web</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> anyhow</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> serde</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> clap</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.</strong> log</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> config</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Design patterns</li><li class="chapter-item expanded "><div><strong aria-hidden="true">19.</strong> Behavioural Patterns</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.</strong> Creational Patterns</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">21.</strong> Structural Patterns</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Rust Idioms</li><li class="chapter-item expanded affix "><div>Concatenating strings with format!</div></li><li class="chapter-item expanded affix "><div>Constructor</div></li><li class="chapter-item expanded affix "><div>The Default Trait</div></li><li class="chapter-item expanded affix "><div>Finalisation in destructors</div></li><li class="chapter-item expanded affix "><div>Temporary mutability</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Tiếng Việt</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-tieng-viet/rust-tieng-viet.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-tieng-viet/rust-tieng-viet.github.io/edit/main/src/basic/ownership.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ownership"><a class="header" href="#ownership">Ownership</a></h1>
<p><em>Ownership</em> là một trong những tính năng đặc trưng của Rust, đây là cách giúp Rust đảm bảo memory safety mà không cần đến garbage collector.</p>
<h1 id="ownership-là-gì"><a class="header" href="#ownership-là-gì">Ownership là gì?</a></h1>
<p>Ownership là một concept mới. Tất cả programs đều cần phải quản lý
memory mà nó sử dụng trong lúc thực thi. Một vài ngôn ngữ sử dụng
garbage collection để tìm và giải phóng bộ nhớ lúc runtime, một số
ngôn ngữ khác thì lập trình viên phải tự chi định (allocate) và giải
phóng (free) bộ nhớ. Rust đi theo một hướng khác, memory được quản lý
bởi một ownership system gồm tập rules được compiler sử dụng để kiểm
tra (check) lúc compile. Bằng cách này thì Rust ép chúng ta viết code theo một
cách an toàn memory-safe, Rust sẽ bắt lỗi ở lúc complie.
Càng hiểu được concept của ownership, thì dần
dần chúng ta có thể viết được code an toàn và hiệu quả hơn.</p>
<p>Để tìm hiểu kỹ hơn về Ownership, bạn có thể đọc Rust Book tại
đây cực kỳ chi tiết:
<a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html#ownership-rules">https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html</a></p>
<h3 id="ownership-rules"><a class="header" href="#ownership-rules">Ownership Rules</a></h3>
<p>Nói đơn giản về <em>ownership rules</em> thì có một số điều cơ bản sau:</p>
<ul>
<li>Mỗi giá trị trong Rust đều có một biến gọi là owner của nó.</li>
<li>Chỉ có một owner tại một thời điểm.</li>
<li>Khi owner ra khỏi scope, giá trị sẽ bị hủy.</li>
</ul>
<h3 id="borrow-checker"><a class="header" href="#borrow-checker">Borrow checker</a></h3>
<p>Bằng cách theo dõi data sử dụng thông qua bộ rules,
borrow checker có thể xác định khi nào data cần được khởi tạo
(initialized) và khi nào cần được giải phóng (freed, or dropped).<br />
Thực tế sẽ có một trong ba trường hợp sau khi bạn sử dụng variable:
tự move data và bỏ ownership; copy data sang một variable khác;
hoặc sử dụng reference (con trỏ) đến data và vẫn giữ ownership,
cho mượn (borrow) nó một thời gian.</p>
<p>Chỉ cần nhớ hai quy tắc quan trọng:</p>
<ol>
<li>Khi truyền một variable (thay vì reference tới variable) cho một function khác, ta sẽ mất quyền ownership. Function đó sẽ là owner của variable này và bạn không thể sử dụng lại được nữa ở context cũ.</li>
<li>Khi truyền một reference tới variable, bạn có thể <strong>immutable</strong> borrow không giới hạn; hoặc <strong>mutable</strong> borrow một lần.</li>
</ol>
<p>Ví dụ: đoạn chương trình sau sẽ không compile được</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn hold_my_vec&lt;T&gt;(_: Vec&lt;T&gt;) {}

fn main() {
  let x = vec![1, 2, 3];
  hold_my_vec(x);

  let z = x.get(0);
  println!(&quot;Got: {:?}&quot;, z);
}
</code></pre></pre>
<p>Compiler sẽ báo lỗi như sau: <code>rustc main.rs</code></p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>error[E0382]: borrow of moved value: `x`
    --&gt; main.rs:7:13
  |
4 |  let x = vec![1, 2, 3];
  |      - move occurs because `x` has type `Vec&lt;i32&gt;`, which does not implement the `Copy` trait
5 |  hold_my_vec(x);
  |              - value moved here
6 |
7 |  let z = x.get(0);
  |          ^^^^^^^^ value borrowed here after move
  |
  = note: borrow occurs due to deref coercion to `[i32]`
<span class="boring">}
</span></code></pre></pre>
<p>Lỗi nói rằng <code>Vec&lt;i32&gt;</code> không implement
<a href="https://doc.rust-lang.org/std/marker/trait.Copy.html">Copy trait</a>,
vì thế data sẽ được di chuyển (move) hoặc mượn (borrow) vào function
<code>hold_my_vec()</code>. Do đó dòng 7 không thể thực hiện được do <code>x</code> được
được move vào trong function kia.</p>
<p>Mặc dùng không thể implement <code>Copy</code> trait, <code>Vec</code> vẫn có
<a href="https://doc.rust-lang.org/core/clone/trait.Clone.html">Clone trait</a>.
Chỉ để cho code chạy được thì đây là một cách nhanh để compiler ngưng báo lỗi.
Lưu ý thì việc clone thường sẽ tốn khá nhiều chi phí, nhất là đối với những object lớn.</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn hold_my_vec&lt;T&gt;(_: Vec&lt;T&gt;) {}

fn main() {
  let x = vec![1, 2, 3];
  hold_my_vec(x.clone()); // &lt;-- x.clone()

  let z = x.get(0);
  println!(&quot;Got: {:?}&quot;, z);
}
</code></pre></pre>
<p>Trong trường hợp này thì function <code>hold_my_vec</code> không làm gì ngoài
việc take ownership. Có một cách tốt hơn là <strong>references.</strong> Thay vì
để function take ownership, ta có thể cho nó mượn giá trị.
Chúng ta sẽ truyền vào một reference — a borrowed value.</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn hold_my_vec&lt;T&gt;(_: &amp;Vec&lt;T&gt;) {}

fn main() {
  let x = vec![1, 2, 3];
  hold_my_vec(&amp;x); // &lt;--- &amp;x

  let z = x.get(0);
  println!(&quot;Got: {:?}&quot;, z);
}
</code></pre></pre>
<p>Với cách này thì chúng ta sẽ để function mượn trong khi
vẫn có thể tiếp tục sử sử dụng trong chương trình.</p>
<p>Bạn có thể đọc thêm về <a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html">Ownership</a>,
<a href="https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html#references-and-borrowing">References and Borrowing</a> và
<a href="https://doc.rust-lang.org/book/ch04-03-slices.html#the-slice-type">The Slice Type</a> tại the Rust Book.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../basic/variables.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../basic/variables.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
