<!DOCTYPE HTML>
<html lang="vi" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Privacy for extensibility - Rust Tiếng Việt</title>


        <!-- Custom HTML head -->
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-88RKF7DLPY"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-88RKF7DLPY');
        </script>
        
        <!-- pageview.js -->
        <script>
          !function(e,n,t){e.onload=function(){
          let e=n.createElement("script");
          e.src=t,n.body.appendChild(e)}}
          (window,document,"https://pageview.duyet.net/pageview.js");
        </script>
        
        <script async src="https://seline.duyet.workers.dev/seline.js" data-api-host="https://seline.duyet.workers.dev" data-token="d7c8002f8e40139"></script>
        <script async src="https://cm43xj8zd00093b619ak2zfuc.d.jitsu.com/p.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Tiếng Việt</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-tieng-viet/rust-tieng-viet.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-tieng-viet/rust-tieng-viet.github.io/edit/main/src/idioms/privacy-for-extensibility.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="privacy-for-extensibility"><a class="header" href="#privacy-for-extensibility">Privacy for Extensibility</a></h1>
<p>Một trong những idioms quan trọng nhất trong Rust API design là sử dụng privacy (tính riêng tư) để đảm bảo API có thể được mở rộng trong tương lai mà không breaking changes.</p>
<h2 id="nguyên-tắc-cơ-bản"><a class="header" href="#nguyên-tắc-cơ-bản">Nguyên tắc cơ bản</a></h2>
<p><strong>Mặc định, hãy giữ mọi thứ private, chỉ expose những gì cần thiết.</strong></p>
<p>Điều này cho phép bạn thay đổi implementation details trong tương lai mà không ảnh hưởng đến users của library.</p>
<h2 id="ví-dụ-struct-fields"><a class="header" href="#ví-dụ-struct-fields">Ví dụ: Struct Fields</a></h2>
<h3 id="-không-nên-public-fields"><a class="header" href="#-không-nên-public-fields">❌ Không nên: Public fields</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">pub struct User {
    pub username: String,
    pub email: String,
    pub age: u32,
}

fn main() {
    let user = User {
        username: "duyet".to_string(),
        email: "duyet@example.com".to_string(),
        age: 25,
    };

    // Users có thể truy cập và modify trực tiếp
    println!("{}", user.age);
}</code></pre></pre>
<p><strong>Vấn đề:</strong></p>
<ul>
<li>Không thể thêm validation</li>
<li>Không thể track changes</li>
<li>Không thể thay đổi internal representation</li>
<li>Breaking change nếu rename hoặc xóa field</li>
</ul>
<h3 id="-nên-private-fields-với-accessor-methods"><a class="header" href="#-nên-private-fields-với-accessor-methods">✅ Nên: Private fields với accessor methods</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">pub struct User {
    username: String,
    email: String,
    age: u32,
}

impl User {
    pub fn new(username: String, email: String, age: u32) -&gt; Result&lt;Self, String&gt; {
        if age &gt; 150 {
            return Err("Invalid age".to_string());
        }
        if !email.contains('@') {
            return Err("Invalid email".to_string());
        }

        Ok(User { username, email, age })
    }

    pub fn username(&amp;self) -&gt; &amp;str {
        &amp;self.username
    }

    pub fn email(&amp;self) -&gt; &amp;str {
        &amp;self.email
    }

    pub fn age(&amp;self) -&gt; u32 {
        self.age
    }

    pub fn set_email(&amp;mut self, email: String) -&gt; Result&lt;(), String&gt; {
        if !email.contains('@') {
            return Err("Invalid email".to_string());
        }
        self.email = email;
        Ok(())
    }
}

fn main() {
    let user = User::new(
        "duyet".to_string(),
        "duyet@example.com".to_string(),
        25,
    ).unwrap();

    println!("{}", user.age());
}</code></pre></pre>
<p><strong>Ưu điểm:</strong></p>
<ul>
<li>Có thể thêm validation logic</li>
<li>Có thể thay đổi internal representation</li>
<li>Có thể track changes, logging</li>
<li>API ổn định hơn</li>
</ul>
<h2 id="non-exhaustive-enums"><a class="header" href="#non-exhaustive-enums">Non-exhaustive Enums</a></h2>
<p>Sử dụng <code>#[non_exhaustive]</code> để cho phép thêm variants trong tương lai:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[non_exhaustive]
pub enum Error {
    NotFound,
    PermissionDenied,
    Timeout,
}

// Trong tương lai có thể thêm:
// NetworkError,
// DatabaseError,
// ...mà không breaking existing code
<span class="boring">}</span></code></pre></pre>
<p>Users buộc phải có default case khi match:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn handle_error(error: Error) {
    match error {
        Error::NotFound =&gt; println!("Not found"),
        Error::PermissionDenied =&gt; println!("Permission denied"),
        Error::Timeout =&gt; println!("Timeout"),
        // Bắt buộc phải có _ case
        _ =&gt; println!("Other error"),
    }
}
<span class="boring">}</span></code></pre></pre>
<h2 id="non-exhaustive-structs"><a class="header" href="#non-exhaustive-structs">Non-exhaustive Structs</a></h2>
<p>Tương tự với structs, <code>#[non_exhaustive]</code> prevent users khởi tạo trực tiếp:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[non_exhaustive]
pub struct Config {
    pub host: String,
    pub port: u16,
}

impl Config {
    pub fn new(host: String, port: u16) -&gt; Self {
        Config { host, port }
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Users không thể sử dụng struct literal syntax:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ❌ Compile error!
// let config = Config {
//     host: "localhost".to_string(),
//     port: 8080,
// };

// ✅ Must use constructor
let config = Config::new("localhost".to_string(), 8080);
<span class="boring">}</span></code></pre></pre>
<h2 id="builder-pattern-cho-extensibility"><a class="header" href="#builder-pattern-cho-extensibility">Builder Pattern cho Extensibility</a></h2>
<p>Builder pattern giúp thêm fields mới mà không breaking changes:</p>
<pre><pre class="playground"><code class="language-rust edition2021">pub struct HttpClient {
    timeout: u64,
    retry_count: u32,
    user_agent: String,
}

pub struct HttpClientBuilder {
    timeout: u64,
    retry_count: u32,
    user_agent: String,
}

impl HttpClient {
    pub fn builder() -&gt; HttpClientBuilder {
        HttpClientBuilder {
            timeout: 30,
            retry_count: 3,
            user_agent: "MyClient/1.0".to_string(),
        }
    }
}

impl HttpClientBuilder {
    pub fn timeout(mut self, timeout: u64) -&gt; Self {
        self.timeout = timeout;
        self
    }

    pub fn retry_count(mut self, count: u32) -&gt; Self {
        self.retry_count = count;
        self
    }

    pub fn user_agent(mut self, agent: String) -&gt; Self {
        self.user_agent = agent;
        self
    }

    pub fn build(self) -&gt; HttpClient {
        HttpClient {
            timeout: self.timeout,
            retry_count: self.retry_count,
            user_agent: self.user_agent,
        }
    }
}

fn main() {
    let client = HttpClient::builder()
        .timeout(60)
        .retry_count(5)
        .build();
}</code></pre></pre>
<p>Trong tương lai có thể thêm field mới:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct HttpClientBuilder {
    timeout: u64,
    retry_count: u32,
    user_agent: String,
    // Thêm mới - không breaking change!
    max_redirects: u32,
}

impl HttpClientBuilder {
    // Thêm method mới
    pub fn max_redirects(mut self, max: u32) -&gt; Self {
        self.max_redirects = max;
        self
    }
}

// Existing code vẫn hoạt động bình thường!
let client = HttpClient::builder()
    .timeout(60)
    .build();
<span class="boring">}</span></code></pre></pre>
<h2 id="private-modules"><a class="header" href="#private-modules">Private modules</a></h2>
<p>Sử dụng private modules để ẩn implementation details:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// lib.rs
mod internal {
    // Private helper functions
    pub(crate) fn helper() {
        // ...
    }
}

pub mod api {
    // Public API
    pub fn public_function() {
        crate::internal::helper();
    }
}
<span class="boring">}</span></code></pre></pre>
<h2 id="sealed-trait-pattern"><a class="header" href="#sealed-trait-pattern">Sealed Trait Pattern</a></h2>
<p>Prevent users implement trait của bạn:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod sealed {
    pub trait Sealed {}
}

pub trait MyTrait: sealed::Sealed {
    fn do_something(&amp;self);
}

// Chỉ types trong module này có thể implement MyTrait
impl sealed::Sealed for MyType {}
impl MyTrait for MyType {
    fn do_something(&amp;self) {
        // ...
    }
}

// Users không thể implement MyTrait cho types của họ
// vì không thể access sealed::Sealed
<span class="boring">}</span></code></pre></pre>
<h2 id="visibility-modifiers"><a class="header" href="#visibility-modifiers">Visibility Modifiers</a></h2>
<p>Rust cung cấp nhiều levels của visibility:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Container {
    pub public_field: i32,           // Accessible everywhere
    pub(crate) crate_field: i32,     // Accessible within crate
    pub(super) parent_field: i32,    // Accessible in parent module
    private_field: i32,               // Accessible in same module
}
<span class="boring">}</span></code></pre></pre>
<h2 id="real-world-example-database-client"><a class="header" href="#real-world-example-database-client">Real-world Example: Database Client</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Database {
    // Private: có thể thay đổi từ String sang URL type
    connection_string: String,
    // Private: có thể switch sang connection pool
    max_connections: u32,
}

impl Database {
    pub fn connect(url: &amp;str) -&gt; Result&lt;Self, String&gt; {
        // Validation
        if url.is_empty() {
            return Err("Empty URL".to_string());
        }

        Ok(Database {
            connection_string: url.to_string(),
            max_connections: 10,
        })
    }

    pub fn with_max_connections(url: &amp;str, max: u32) -&gt; Result&lt;Self, String&gt; {
        let mut db = Self::connect(url)?;
        db.max_connections = max;
        Ok(db)
    }

    pub fn execute(&amp;self, query: &amp;str) -&gt; Result&lt;Vec&lt;String&gt;, String&gt; {
        // Implementation có thể thay đổi hoàn toàn
        println!("Executing: {}", query);
        Ok(vec![])
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Trong tương lai có thể thay đổi implementation:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::sync::Arc;

pub struct Database {
    // Thay đổi internal structure
    connection_pool: Arc&lt;ConnectionPool&gt;,
    config: DatabaseConfig,
}

// Public API không thay đổi!
impl Database {
    pub fn connect(url: &amp;str) -&gt; Result&lt;Self, String&gt; {
        // New implementation
        // ...
    }

    pub fn execute(&amp;self, query: &amp;str) -&gt; Result&lt;Vec&lt;String&gt;, String&gt; {
        // New implementation using pool
        // ...
    }
}
<span class="boring">}</span></code></pre></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<ol>
<li><strong>Start private</strong>: Mặc định mọi thứ private, expose dần khi cần</li>
<li><strong>Use <code>#[non_exhaustive]</code></strong>: Cho enums và structs có thể mở rộng</li>
<li><strong>Prefer methods over public fields</strong>: Giữ control và flexibility</li>
<li><strong>Document stability</strong>: Ghi rõ API nào stable, nào experimental</li>
<li><strong>Use semantic versioning</strong>: Breaking changes = major version bump</li>
</ol>
<h2 id="anti-patterns"><a class="header" href="#anti-patterns">Anti-patterns</a></h2>
<p>❌ <strong>Tránh expose internal types:</strong></p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ❌ Bad
pub use internal::InternalType;

pub fn process() -&gt; InternalType {
    // ...
}
<span class="boring">}</span></code></pre></pre>
<p>✅ <strong>Wrap hoặc convert:</strong></p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ✅ Good
pub struct PublicType {
    // ...
}

pub fn process() -&gt; PublicType {
    let internal = internal::InternalType::new();
    PublicType::from(internal)
}
<span class="boring">}</span></code></pre></pre>
<h2 id="tham-khảo"><a class="header" href="#tham-khảo">Tham khảo</a></h2>
<ul>
<li><a href="https://rust-lang.github.io/api-guidelines/future-proofing.html">Rust API Guidelines - Future proofing</a></li>
<li><a href="https://doc.rust-lang.org/reference/visibility-and-privacy.html">The Rust Reference - Visibility</a></li>
<li><a href="https://rust-lang.github.io/api-guidelines/future-proofing.html#sealed-traits-protect-against-downstream-implementations-c-sealed">Sealed Trait Pattern</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../idioms/mem-replace.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../idioms/option-iter.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../idioms/mem-replace.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../idioms/option-iter.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
