<!DOCTYPE HTML>
<html lang="vi" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Zero-Cost Abstractions - Rust Tiếng Việt</title>


        <!-- Custom HTML head -->
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-88RKF7DLPY"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-88RKF7DLPY');
        </script>
        
        <!-- pageview.js -->
        <script>
          !function(e,n,t){e.onload=function(){
          let e=n.createElement("script");
          e.src=t,n.body.appendChild(e)}}
          (window,document,"https://pageview.duyet.net/pageview.js");
        </script>
        
        <script async src="https://seline.duyet.workers.dev/seline.js" data-api-host="https://seline.duyet.workers.dev" data-token="d7c8002f8e40139"></script>
        <script async src="https://cm43xj8zd00093b619ak2zfuc.d.jitsu.com/p.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Tiếng Việt</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-tieng-viet/rust-tieng-viet.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-tieng-viet/rust-tieng-viet.github.io/edit/main/src/idioms/zero-cost-abstractions.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="zero-cost-abstractions"><a class="header" href="#zero-cost-abstractions">Zero-Cost Abstractions</a></h1>
<p>Zero-cost abstractions là một trong những principles quan trọng nhất của Rust: bạn có thể viết high-level code với abstractions mạnh mẽ, nhưng không phải trả giá về performance. Compiler tối ưu abstractions thành machine code hiệu quả như hand-written low-level code.</p>
<h2 id="nguyên-tắc"><a class="header" href="#nguyên-tắc">Nguyên tắc</a></h2>
<blockquote>
<p>"What you don't use, you don't pay for. And further: What you do use, you couldn't hand code any better."</p>
<ul>
<li>Bjarne Stroustrup</li>
</ul>
</blockquote>
<p>Trong Rust:</p>
<ul>
<li>Abstractions không có runtime overhead</li>
<li>Compiler inline và optimize tối đa</li>
<li>High-level code = Low-level performance</li>
</ul>
<h2 id="iterator-chains-vs-loops"><a class="header" href="#iterator-chains-vs-loops">Iterator Chains vs Loops</a></h2>
<h3 id="loop-thủ-công"><a class="header" href="#loop-thủ-công">Loop thủ công</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn sum_of_squares_manual(numbers: &amp;[i32]) -&gt; i32 {
    let mut sum = 0;
    for i in 0..numbers.len() {
        let n = numbers[i];
        if n % 2 == 0 {
            sum += n * n;
        }
    }
    sum
}
<span class="boring">}</span></code></pre></pre>
<h3 id="iterator-chain-zero-cost"><a class="header" href="#iterator-chain-zero-cost">Iterator chain (zero-cost!)</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">fn sum_of_squares_iterator(numbers: &amp;[i32]) -&gt; i32 {
    numbers.iter()
        .filter(|n| *n % 2 == 0)
        .map(|n| n * n)
        .sum()
}

fn main() {
    let nums = vec![1, 2, 3, 4, 5, 6];

    let manual = sum_of_squares_manual(&amp;nums);
    let iterator = sum_of_squares_iterator(&amp;nums);

    assert_eq!(manual, iterator);  // 56
    println!("Result: {}", iterator);

    // Cả hai compile thành CÙNG machine code!
}</code></pre></pre>
<h2 id="compiler-optimization"><a class="header" href="#compiler-optimization">Compiler Optimization</a></h2>
<p>Compiler Rust optimize iterator chains qua:</p>
<h3 id="1-inlining"><a class="header" href="#1-inlining">1. Inlining</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// High-level code
let result: i32 = (1..=100)
    .filter(|x| x % 2 == 0)
    .map(|x| x * x)
    .sum();

// Compiler tối ưu thành tương đương:
let mut result = 0;
for x in 1..=100 {
    if x % 2 == 0 {
        result += x * x;
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="2-loop-fusion"><a class="header" href="#2-loop-fusion">2. Loop Fusion</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Nhiều operations
let result: Vec&lt;_&gt; = data
    .iter()
    .map(|x| x + 1)
    .filter(|x| x % 2 == 0)
    .map(|x| x * 2)
    .collect();

// Compiler merge thành single loop
// Không có intermediate allocations!
<span class="boring">}</span></code></pre></pre>
<h2 id="generic-functions---zero-overhead"><a class="header" href="#generic-functions---zero-overhead">Generic Functions - Zero Overhead</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">// Generic function
fn print_value&lt;T: std::fmt::Display&gt;(value: T) {
    println!("{}", value);
}

fn main() {
    print_value(42);           // Monomorphized cho i32
    print_value("hello");      // Monomorphized cho &amp;str
    print_value(3.14);         // Monomorphized cho f64

    // Compiler tạo 3 versions riêng biệt
    // Mỗi version được inline và optimize
    // Zero runtime cost!
}</code></pre></pre>
<h2 id="trait-objects-vs-generics"><a class="header" href="#trait-objects-vs-generics">Trait Objects vs Generics</a></h2>
<h3 id="static-dispatch-zero-cost"><a class="header" href="#static-dispatch-zero-cost">Static Dispatch (zero-cost)</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">trait Process {
    fn process(&amp;self) -&gt; i32;
}

struct AddOne;
struct Double;

impl Process for AddOne {
    fn process(&amp;self, value: i32) -&gt; i32 {
        value + 1
    }
}

impl Process for Double {
    fn process(&amp;self, value: i32) -&gt; i32 {
        value * 2
    }
}

// ✅ Static dispatch - zero cost
fn apply_static&lt;T: Process&gt;(processor: &amp;T, value: i32) -&gt; i32 {
    processor.process(value)  // Compile-time dispatch
}

fn main() {
    let add = AddOne;
    let result = apply_static(&amp;add, 10);  // Direct function call!
    println!("{}", result);
}</code></pre></pre>
<h3 id="dynamic-dispatch-có-runtime-cost"><a class="header" href="#dynamic-dispatch-có-runtime-cost">Dynamic Dispatch (có runtime cost)</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">// ❌ Dynamic dispatch - runtime overhead
fn apply_dynamic(processor: &amp;dyn Process, value: i32) -&gt; i32 {
    processor.process(value)  // Virtual function call
}

fn main() {
    let add = AddOne;
    let result = apply_dynamic(&amp;add as &amp;dyn Process, 10);
    println!("{}", result);
}</code></pre></pre>
<h2 id="newtype-pattern---zero-cost"><a class="header" href="#newtype-pattern---zero-cost">Newtype Pattern - Zero Cost</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">struct UserId(u64);
struct ProductId(u64);

fn get_user(id: UserId) -&gt; String {
    format!("User {}", id.0)
}

fn main() {
    let user = UserId(123);

    // Type safety với zero runtime cost
    // Compiled code giống như truyền u64 trực tiếp!
    println!("{}", get_user(user));
}</code></pre></pre>
<h2 id="smart-pointers"><a class="header" href="#smart-pointers">Smart Pointers</a></h2>
<h3 id="box---heap-allocation"><a class="header" href="#box---heap-allocation">Box<T> - Heap Allocation</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() {
    let x = Box::new(5);

    // Box chỉ là pointer wrapper
    // Deref tự động - zero cost!
    println!("{}", *x);

    // Compiled thành simple pointer operations
}</code></pre></pre>
<h3 id="rc---reference-counting"><a class="header" href="#rc---reference-counting">Rc<T> - Reference Counting</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">use std::rc::Rc;

fn main() {
    let data = Rc::new(vec![1, 2, 3]);
    let data2 = Rc::clone(&amp;data);

    // Reference counting có cost (increment/decrement)
    // Nhưng efficient và predictable!
}</code></pre></pre>
<h2 id="data-processing-pipeline---zero-cost"><a class="header" href="#data-processing-pipeline---zero-cost">Data Processing Pipeline - Zero Cost</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">#[derive(Debug, Clone)]
struct Record {
    id: u64,
    value: f64,
    active: bool,
}

fn process_records(records: &amp;[Record]) -&gt; Vec&lt;f64&gt; {
    records.iter()
        .filter(|r| r.active)           // Zero-cost filter
        .filter(|r| r.value &gt; 100.0)    // Chain filters
        .map(|r| r.value * 1.1)         // Transform
        .collect()                       // Single allocation
}

fn main() {
    let records = vec![
        Record { id: 1, value: 150.0, active: true },
        Record { id: 2, value: 50.0, active: true },
        Record { id: 3, value: 200.0, active: false },
        Record { id: 4, value: 120.0, active: true },
    ];

    let results = process_records(&amp;records);
    println!("Processed: {:?}", results);
    // [165.0, 132.0]

    // Compiler optimize thành efficient loop
    // Không có intermediate collections!
}</code></pre></pre>
<h2 id="benchmark-iterator-vs-loop"><a class="header" href="#benchmark-iterator-vs-loop">Benchmark: Iterator vs Loop</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">use std::time::Instant;

fn benchmark_iterator(data: &amp;[i32]) -&gt; i32 {
    data.iter()
        .filter(|&amp;&amp;x| x % 2 == 0)
        .map(|&amp;x| x * x)
        .sum()
}

fn benchmark_loop(data: &amp;[i32]) -&gt; i32 {
    let mut sum = 0;
    for &amp;x in data {
        if x % 2 == 0 {
            sum += x * x;
        }
    }
    sum
}

fn main() {
    let data: Vec&lt;i32&gt; = (1..=1_000_000).collect();

    // Benchmark iterator
    let start = Instant::now();
    let result1 = benchmark_iterator(&amp;data);
    let duration1 = start.elapsed();

    // Benchmark loop
    let start = Instant::now();
    let result2 = benchmark_loop(&amp;data);
    let duration2 = start.elapsed();

    assert_eq!(result1, result2);

    println!("Iterator: {:?}", duration1);
    println!("Loop:     {:?}", duration2);
    // Performance gần như giống nhau!
}</code></pre></pre>
<h2 id="closure-optimization"><a class="header" href="#closure-optimization">Closure Optimization</a></h2>
<h3 id="zero-cost-closures"><a class="header" href="#zero-cost-closures">Zero-cost closures</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">fn apply_operation&lt;F&gt;(data: &amp;[i32], op: F) -&gt; Vec&lt;i32&gt;
where
    F: Fn(i32) -&gt; i32,
{
    data.iter().map(|&amp;x| op(x)).collect()
}

fn main() {
    let numbers = vec![1, 2, 3, 4, 5];

    // Closure được inline!
    let doubled = apply_operation(&amp;numbers, |x| x * 2);

    println!("{:?}", doubled);
    // Compiled thành direct operations - zero overhead!
}</code></pre></pre>
<h2 id="const-generics---compile-time-computation"><a class="header" href="#const-generics---compile-time-computation">Const Generics - Compile-time Computation</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">struct Matrix&lt;T, const ROWS: usize, const COLS: usize&gt; {
    data: [[T; COLS]; ROWS],
}

impl&lt;T: Default + Copy, const ROWS: usize, const COLS: usize&gt; Matrix&lt;T, ROWS, COLS&gt; {
    fn new() -&gt; Self {
        Matrix {
            data: [[T::default(); COLS]; ROWS],
        }
    }
}

fn main() {
    // Size checked tại compile-time
    let matrix1: Matrix&lt;f64, 3, 3&gt; = Matrix::new();
    let matrix2: Matrix&lt;f64, 5, 5&gt; = Matrix::new();

    // Zero runtime overhead cho size checks!
}</code></pre></pre>
<h2 id="option-và-result---zero-cost"><a class="header" href="#option-và-result---zero-cost">Option và Result - Zero Cost</a></h2>
<h3 id="option"><a class="header" href="#option">Option<T></a></h3>
<pre><pre class="playground"><code class="language-rust edition2021">fn find_value(data: &amp;[i32], target: i32) -&gt; Option&lt;usize&gt; {
    for (i, &amp;value) in data.iter().enumerate() {
        if value == target {
            return Some(i);
        }
    }
    None
}

fn main() {
    let numbers = vec![10, 20, 30, 40];

    match find_value(&amp;numbers, 30) {
        Some(index) =&gt; println!("Found at index: {}", index),
        None =&gt; println!("Not found"),
    }

    // Option được optimize thành simple enum
    // Không có heap allocation hoặc indirection!
}</code></pre></pre>
<h2 id="parallel-iterators-với-rayon---near-zero-cost"><a class="header" href="#parallel-iterators-với-rayon---near-zero-cost">Parallel Iterators với Rayon - Near Zero Cost</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">use rayon::prelude::*;

fn sum_sequential(data: &amp;[i32]) -&gt; i32 {
    data.iter().map(|&amp;x| x * x).sum()
}

fn sum_parallel(data: &amp;[i32]) -&gt; i32 {
    data.par_iter().map(|&amp;x| x * x).sum()
}

fn main() {
    let data: Vec&lt;i32&gt; = (1..=10_000_000).collect();

    let start = std::time::Instant::now();
    let seq = sum_sequential(&amp;data);
    println!("Sequential: {:?}", start.elapsed());

    let start = std::time::Instant::now();
    let par = sum_parallel(&amp;data);
    println!("Parallel:   {:?}", start.elapsed());

    assert_eq!(seq, par);

    // Parallel faster với minimal overhead!
}</code></pre></pre>
<h2 id="match-expression---zero-cost"><a class="header" href="#match-expression---zero-cost">Match Expression - Zero Cost</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">enum DataType {
    Integer(i64),
    Float(f64),
    Text(String),
}

fn process_data(data: DataType) -&gt; String {
    match data {
        DataType::Integer(n) =&gt; format!("Int: {}", n),
        DataType::Float(f) =&gt; format!("Float: {:.2}", f),
        DataType::Text(s) =&gt; format!("Text: {}", s),
    }
}

fn main() {
    let values = vec![
        DataType::Integer(42),
        DataType::Float(3.14),
        DataType::Text("hello".to_string()),
    ];

    for value in values {
        println!("{}", process_data(value));
    }

    // Match compiled thành efficient jump table
    // Zero overhead vs if-else chain!
}</code></pre></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-prefer-iterators-over-manual-loops"><a class="header" href="#1-prefer-iterators-over-manual-loops">1. Prefer iterators over manual loops</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ✅ Zero-cost và clear intent
let sum: i32 = data.iter().filter(|&amp;&amp;x| x &gt; 0).sum();

// ❌ Verbose và dễ bugs
let mut sum = 0;
for &amp;x in data {
    if x &gt; 0 {
        sum += x;
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="2-use-generics-cho-reusable-code"><a class="header" href="#2-use-generics-cho-reusable-code">2. Use generics cho reusable code</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ✅ Generic - monomorphized tại compile-time
fn process&lt;T: std::fmt::Display&gt;(value: T) {
    println!("{}", value);
}

// ❌ Trait object - runtime overhead
fn process_dyn(value: &amp;dyn std::fmt::Display) {
    println!("{}", value);
}
<span class="boring">}</span></code></pre></pre>
<h3 id="3-chain-operations"><a class="header" href="#3-chain-operations">3. Chain operations</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ✅ Chaining - compiler optimize
let result = data
    .iter()
    .filter(|x| x.is_valid())
    .map(|x| x.transform())
    .collect();

// ❌ Intermediate collections - allocations
let filtered: Vec&lt;_&gt; = data.iter().filter(|x| x.is_valid()).collect();
let mapped: Vec&lt;_&gt; = filtered.iter().map(|x| x.transform()).collect();
<span class="boring">}</span></code></pre></pre>
<h3 id="4-leverage-type-system"><a class="header" href="#4-leverage-type-system">4. Leverage type system</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ✅ Newtype - compile-time safety, zero runtime cost
struct UserId(u64);

fn get_user(id: UserId) { }

// ❌ Primitive type - dễ nhầm lẫn
fn get_user_raw(id: u64) { }
<span class="boring">}</span></code></pre></pre>
<h2 id="ví-dụ-thực-tế-etl-pipeline"><a class="header" href="#ví-dụ-thực-tế-etl-pipeline">Ví dụ thực tế: ETL Pipeline</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">#[derive(Debug, Clone)]
struct Customer {
    id: u64,
    name: String,
    age: u32,
    revenue: f64,
}

fn extract_transform_load(customers: &amp;[Customer]) -&gt; Vec&lt;(String, f64)&gt; {
    customers
        .iter()
        .filter(|c| c.age &gt;= 18)                    // Filter
        .filter(|c| c.revenue &gt; 1000.0)             // Additional filter
        .map(|c| (c.name.to_uppercase(), c.revenue * 1.1))  // Transform
        .collect()                                  // Load
}

fn main() {
    let customers = vec![
        Customer { id: 1, name: "Alice".to_string(), age: 25, revenue: 5000.0 },
        Customer { id: 2, name: "Bob".to_string(), age: 17, revenue: 2000.0 },
        Customer { id: 3, name: "Charlie".to_string(), age: 30, revenue: 500.0 },
        Customer { id: 4, name: "Diana".to_string(), age: 28, revenue: 3000.0 },
    ];

    let result = extract_transform_load(&amp;customers);

    for (name, revenue) in result {
        println!("{}: ${:.2}", name, revenue);
    }

    // ALICE: $5500.00
    // DIANA: $3300.00

    // Entire pipeline compiled thành efficient loop
    // Single pass qua data
    // Minimal allocations
}</code></pre></pre>
<h2 id="assembly-comparison"><a class="header" href="#assembly-comparison">Assembly Comparison</a></h2>
<p>Xem compiler output với <code>cargo asm</code> hoặc Compiler Explorer (godbolt.org):</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn iterator_sum(data: &amp;[i32]) -&gt; i32 {
    data.iter().filter(|&amp;&amp;x| x &gt; 0).sum()
}

pub fn loop_sum(data: &amp;[i32]) -&gt; i32 {
    let mut sum = 0;
    for &amp;x in data {
        if x &gt; 0 {
            sum += x;
        }
    }
    sum
}

// Cả hai functions compile thành CÙNG assembly code!
<span class="boring">}</span></code></pre></pre>
<h2 id="khi-nào-abstractions-cÓ-cost"><a class="header" href="#khi-nào-abstractions-cÓ-cost">Khi nào abstractions CÓ cost?</a></h2>
<h3 id="1-dynamic-dispatch"><a class="header" href="#1-dynamic-dispatch">1. Dynamic dispatch</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Runtime overhead do virtual function calls
fn process(handler: &amp;dyn Handler) {
    handler.handle();  // Indirect call
}
<span class="boring">}</span></code></pre></pre>
<h3 id="2-excessive-allocations"><a class="header" href="#2-excessive-allocations">2. Excessive allocations</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Mỗi step allocate new Vec
let step1: Vec&lt;_&gt; = data.iter().map(|x| x + 1).collect();
let step2: Vec&lt;_&gt; = step1.iter().map(|x| x * 2).collect();
let step3: Vec&lt;_&gt; = step2.iter().filter(|&amp;&amp;x| x &gt; 10).collect();
<span class="boring">}</span></code></pre></pre>
<h3 id="3-unnecessary-clones"><a class="header" href="#3-unnecessary-clones">3. Unnecessary clones</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Clone toàn bộ data mỗi iteration
for item in data.clone() {  // ❌
    // ...
}
<span class="boring">}</span></code></pre></pre>
<h2 id="tổng-kết"><a class="header" href="#tổng-kết">Tổng kết</a></h2>
<p>Zero-cost abstractions trong Rust:</p>
<ul>
<li>✅ High-level code = Low-level performance</li>
<li>✅ Iterators nhanh như loops</li>
<li>✅ Generics không có runtime overhead</li>
<li>✅ Newtypes không có cost</li>
<li>✅ Smart abstractions được optimize tối đa</li>
</ul>
<p>Best practices:</p>
<ol>
<li>Prefer iterators và chaining</li>
<li>Use generics cho static dispatch</li>
<li>Leverage type system</li>
<li>Trust the optimizer</li>
<li>Measure khi optimization quan trọng</li>
</ol>
<p>Rust motto: "Zero-cost abstractions - you don't pay for what you don't use!"</p>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://blog.rust-lang.org/2015/05/11/traits.html">Zero-Cost Abstractions</a></li>
<li><a href="https://doc.rust-lang.org/book/ch13-04-performance.html">Iterator Performance</a></li>
<li><a href="https://godbolt.org/">Compiler Explorer</a></li>
<li><a href="https://nnethercote.github.io/perf-book/">Rust Performance Book</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../idioms/raii-guards.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../idioms/typestate.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../idioms/raii-guards.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../idioms/typestate.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../editor.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
